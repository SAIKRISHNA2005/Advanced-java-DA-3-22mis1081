<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>#{title} - Online Course Enrollment</title>
        <h:outputStylesheet library="css" name="style.css"/>
    </h:head>

    <h:body>
        <div class="header">
            <div class="container">
                <h1>üéì Online Course Enrollment System</h1>
                <div class="nav-links">
                    <h:form>
                        <ui:fragment rendered="#{studentBean.admin}">
                            <h:commandButton value="Manage Courses" action="admin" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            <h:commandButton value="Manage Users" action="manageUsers" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            <h:commandButton value="Logout" action="#{studentBean.logout}" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                        </ui:fragment>
                        <ui:fragment rendered="#{not studentBean.admin}">
                            <h:commandButton value="Home" action="home" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            <h:commandButton value="Courses" action="courseList" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            <ui:fragment rendered="#{not empty studentBean.currentStudent}">
                                <h:commandButton value="Dashboard" action="dashboard" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                                <h:commandButton value="Profile" action="profile" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                                <h:commandButton value="Logout" action="#{studentBean.logout}" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            </ui:fragment>
                            <ui:fragment rendered="#{empty studentBean.currentStudent}">
                                <h:commandButton value="Login" action="home" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                                <h:commandButton value="Register" action="register" styleClass="button button-outline" style="color: white !important; border-color: white !important;"/>
                            </ui:fragment>
                        </ui:fragment>
                    </h:form>
                </div>
            </div>
        </div>

        <div class="container">
            <h:messages globalOnly="true" styleClass="messages" infoClass="message-success" errorClass="message-error" warnClass="message-info"/>
            <ui:insert name="content"/>
        </div>

        <!-- Toast Notification Container -->
        <div id="toastContainer" class="toast-container"></div>

        <!-- Hidden form to clear toast notifications -->
        <h:form id="clearToastForm" style="display: none;">
            <h:commandButton type="submit" value="Clear" action="#{studentBean.clearToastNotifications}" 
                            style="display: none;" immediate="true"/>
        </h:form>

        <!-- Toast Notification Script -->
        <script type="text/javascript">
            // Show toast notification on page load if success message exists
            window.addEventListener('DOMContentLoaded', function() {
                var registrationSuccess = #{not empty facesContext.externalContext.sessionMap.registrationSuccess ? 'true' : 'false'};
                var registrationMessage = '#{facesContext.externalContext.sessionMap.registrationMessage}';
                var toastShown = false;
                
                if (registrationSuccess &amp;&amp; registrationMessage &amp;&amp; registrationMessage !== '') {
                    showToast('üéâ Registration Successful!', registrationMessage, 'success');
                    toastShown = true;
                    // Clear session attributes after a short delay
                    setTimeout(function() {
                        clearToastNotifications();
                    }, 100);
                }
                
                var enrollmentSuccess = #{not empty facesContext.externalContext.sessionMap.enrollmentSuccess ? 'true' : 'false'};
                var enrollmentMessage = '#{facesContext.externalContext.sessionMap.enrollmentMessage}';
                
                if (enrollmentSuccess &amp;&amp; enrollmentMessage &amp;&amp; enrollmentMessage !== '' &amp;&amp; !toastShown) {
                    showToast('‚úÖ Course Enrolled!', enrollmentMessage, 'success');
                    // Clear session attributes after a short delay
                    setTimeout(function() {
                        clearToastNotifications();
                    }, 100);
                }
            });

            function clearToastNotifications() {
                // Clear session attributes via form submission
                // The form uses immediate="true" to avoid validation and page refresh
                var form = document.getElementById('clearToastForm');
                if (form) {
                    // Submit form silently
                    var iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.name = 'clearToastFrame';
                    document.body.appendChild(iframe);
                    form.target = 'clearToastFrame';
                    form.submit();
                    // Remove iframe after a moment
                    setTimeout(function() {
                        document.body.removeChild(iframe);
                    }, 100);
                }
            }

            function showToast(title, message, type) {
                var container = document.getElementById('toastContainer');
                if (!container) {
                    container = document.createElement('div');
                    container.id = 'toastContainer';
                    container.className = 'toast-container';
                    document.body.appendChild(container);
                }

                var toast = document.createElement('div');
                toast.className = 'toast toast-' + (type || 'success');
                
                var icon = '‚úÖ';
                if (type === 'error') icon = '‚ùå';
                else if (type === 'info') icon = '‚ÑπÔ∏è';
                
                toast.innerHTML = 
                    '<div class="toast-icon">' + icon + '</div>' +
                    '<div class="toast-content">' +
                        '<div class="toast-title">' + title + '</div>' +
                        '<div class="toast-message">' + message + '</div>' +
                    '</div>' +
                    '<button class="toast-close" onclick="this.parentElement.remove()">√ó</button>';
                
                container.appendChild(toast);
                
                // Auto remove after 3 seconds
                setTimeout(function() {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 3000);
            }
        </script>

        <footer style="background: #333; color: white; text-align: center; padding: 20px; margin-top: 40px;">
            <p>&#169; 2024 Online Course Enrollment System. All rights reserved.</p>
        </footer>
    </h:body>
</html>

