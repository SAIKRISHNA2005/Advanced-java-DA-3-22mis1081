<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="/templates/layout.xhtml">
        <ui:define name="title">Course Details</ui:define>
        
        <ui:define name="content">
            <f:metadata>
                <f:viewParam name="courseId" value="#{courseBean.courseId}"/>
                <f:event type="preRenderView" listener="#{courseBean.loadCourseFromParam}"/>
            </f:metadata>
            
            <ui:fragment rendered="#{not empty courseBean.selectedCourse}">
                <!-- Course Header -->
                <div class="course-detail-header">
                    <h1 style="color: white !important;">#{courseBean.selectedCourse.courseName}</h1>
                    <p style="font-size: 1.2rem; color: white !important; opacity: 0.95;">by #{courseBean.selectedCourse.instructor}</p>
                </div>

                <!-- Course Information -->
                <div class="detail-section">
                    <h2 style="color: #333 !important;">ðŸ“– Course Description</h2>
                    <p style="line-height: 1.8; color: #444 !important;">#{courseBean.selectedCourse.description}</p>
                </div>

                <!-- Course Details Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div class="detail-section">
                        <h3 style="color: #333 !important;">ðŸ“… Schedule</h3>
                        <div class="detail-row">
                            <span class="detail-label" style="color: #555 !important;">Start Date:</span>
                            <span class="detail-value" style="color: #333 !important;">#{courseBean.formatDate(courseBean.selectedCourse.startDate)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label" style="color: #555 !important;">End Date:</span>
                            <span class="detail-value" style="color: #333 !important;">#{courseBean.formatDate(courseBean.selectedCourse.endDate)}</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3 style="color: #333 !important;">ðŸ’° Pricing</h3>
                        <div class="price" style="margin: 20px 0; color: var(--success-color) !important;">â‚¹#{courseBean.selectedCourse.fee}</div>
                    </div>

                    <div class="detail-section">
                        <h3 style="color: #333 !important;">ðŸ‘¥ Availability</h3>
                        <div style="margin: 20px 0;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color) !important;">
                                #{courseBean.selectedCourse.capacity - courseBean.selectedCourse.enrolledCount} seats available
                            </div>
                            <div style="color: #555 !important; margin-top: 10px;">
                                #{courseBean.selectedCourse.enrolledCount} of #{courseBean.selectedCourse.capacity} enrolled
                            </div>
                            <div style="background: #e9ecef; height: 10px; border-radius: 5px; margin-top: 10px; overflow: hidden;">
                                <div style="background: var(--primary-color); height: 100%; width: #{courseBean.selectedCourse.capacity > 0 ? (courseBean.selectedCourse.enrolledCount * 100 / courseBean.selectedCourse.capacity) : 0}%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card" style="text-align: center;">
                    <ui:fragment rendered="#{not empty studentBean.currentStudent and not enrollmentBean.isEnrolled(courseBean.selectedCourse.courseId)}">
                        <h:form>
                            <h:commandButton value="ðŸŽ¯ Enroll Now" 
                                            action="#{enrollmentBean.enrollInCourse}"
                                            styleClass="button button-large button-success" 
                                            style="margin: 10px;">
                                <f:param name="courseId" value="#{courseBean.selectedCourse.courseId}"/>
                                <f:param name="fromView" value="courseDetails"/>
                                <!-- ActionListener example for course selection -->
                                <f:actionListener type="com.example.onlinecourse.listener.CourseSelectionListener"/>
                            </h:commandButton>
                        </h:form>
                    </ui:fragment>
                    <ui:fragment rendered="#{not empty studentBean.currentStudent and enrollmentBean.isEnrolled(courseBean.selectedCourse.courseId)}">
                        <div style="padding: 20px; background: #d4edda; border-radius: 8px; margin-bottom: 20px;">
                            <p style="color: #155724; font-weight: 600; margin: 0;">âœ“ You are already enrolled in this course</p>
                        </div>
                    </ui:fragment>
                    <ui:fragment rendered="#{empty studentBean.currentStudent}">
                        <h:form>
                            <h:commandButton value="ðŸ” Login to Enroll" action="home" 
                                            styleClass="button button-large" style="margin: 10px;"/>
                        </h:form>
                    </ui:fragment>
                    <h:form>
                        <h:commandButton value="â† Back to Courses" action="courseList" 
                                        styleClass="button button-secondary" style="margin: 10px;"/>
                    </h:form>
                </div>
            </ui:fragment>

            <ui:fragment rendered="#{empty courseBean.selectedCourse}">
                <div class="card">
                    <div class="empty-state">
                        <p style="font-size: 1.2rem; color: #666 !important;">Course not found</p>
                        <p style="color: #999 !important; margin-top: 10px;">The course you are looking for does not exist or has been removed.</p>
                        <h:form>
                            <h:commandButton value="â† Back to Courses" action="courseList" 
                                            styleClass="button" style="margin-top: 20px;"/>
                        </h:form>
                    </div>
                </div>
            </ui:fragment>
        </ui:define>
    </ui:composition>

</html>
